<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Admin</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(to right, #74ebd5, #ACB6E5);
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.container {
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  width: 90%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  align-items: center;
  max-height: 100vh;
  overflow-y: auto;
}

h2 { text-align:center; margin-bottom:20px; color:#333; }

input, textarea, select, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

textarea { resize: none; height: 80px; }

button {
  background: #007BFF;
  color: white;
  border: none;
  cursor: pointer;
  transition: 0.2s;
}

button:hover { background: #0056b3; }

.field { display:flex; gap:10px; margin-bottom:10px; }
.field input { flex:1; }

.menu button { margin-bottom: 15px; }

hr { margin: 30px 0; }
</style>
</head>
<body>

<div class="container">

  <!-- MENÚ PRINCIPAL -->
  <div id="menu" class="menu">
    <h2>Selecciona una acción</h2>
    <button onclick="showForm('embed')">Crear Embed</button>
    <button onclick="showForm('tokens')">Enviar Mensaje de Tokens</button>
    <button onclick="showForm('status')">Cambiar Estado del Bot</button>
    <button onclick="showForm('invincible')">Activar/Desactivar Invencibilidad</button>
  </div>

  <!-- FORMULARIO CREAR EMBED -->
  <div id="embedFormContainer" style="display:none; width:100%;">
    <h2>Crear Embed</h2>
    <form id="embedForm">
      <input type="text" id="embedChannel" placeholder="ID del canal donde enviar">
      <input type="text" placeholder="Título" id="embedTitle">
      <textarea placeholder="Descripción" id="embedDescription"></textarea>
      <input type="color" id="embedColor" value="#0099ff">
      <input type="text" placeholder="URL Imagen" id="embedImage">
      <input type="text" placeholder="URL Miniatura" id="embedThumbnail">
      <input type="text" placeholder="Autor" id="embedAuthor">
      <input type="text" placeholder="Pie de página" id="embedFooter">

      <div id="fieldsContainer">
        <h3>Campos (Fields)</h3>
        <div class="field">
          <input type="text" placeholder="Nombre campo" class="fieldName">
          <input type="text" placeholder="Valor campo" class="fieldValue">
        </div>
      </div>
      <button type="button" onclick="addField()">Agregar campo</button>
      <button type="submit">Enviar Embed</button>
    </form>
    <button onclick="backToMenu()" style="background:#6c757d;">⬅ Volver al menú</button>
  </div>

  <!-- FORMULARIO ENVIAR TOKENS -->
  <div id="tokensFormContainer" style="display:none; width:100%;">
    <h2>Enviar Mensaje de Tokens</h2>
    <form id="tokensForm">
      <input type="number" id="cantidadTokens" placeholder="Cantidad de tokens">
      <input type="text" id="canalTokens" placeholder="ID del canal donde enviar">
      <input type="text" id="mensajeTokens" placeholder="Mensaje opcional">
      <button type="submit">Enviar Mensaje de Tokens</button>
    </form>
    <button onclick="backToMenu()" style="background:#6c757d;">⬅ Volver al menú</button>
  </div>

  <!-- FORMULARIO CAMBIAR ESTADO DEL BOT -->
  <div id="statusFormContainer" style="display:none; width:100%;">
    <h2>Cambiar Estado del Bot</h2>
    <form id="statusForm">
      <label>Tipo de actividad:</label>
      <select id="activityType">
        <option value="PLAYING">Jugando</option>
        <option value="WATCHING">Viendo</option>
        <option value="LISTENING">Escuchando</option>
        <option value="STREAMING">Streaming</option>
        <option value="COMPETING">Compitiendo</option>
      </select>
      <input type="text" id="activityName" placeholder="Nombre de la actividad">

      <label>Estado del bot:</label>
      <select id="botStatus">
        <option value="online">En línea</option>
        <option value="idle">Ausente</option>
        <option value="dnd">No molestar</option>
        <option value="invisible">Invisible</option>
      </select>

      <button type="submit">Actualizar Estado</button>
    </form>
    <button onclick="backToMenu()" style="background:#6c757d;">⬅ Volver al menú</button>
  </div>

  <!-- FORMULARIO INVENCIBILIDAD -->
  <div id="invincibleFormContainer" style="display:none; width:100%;">
    <h2>Invencibilidad de usuario</h2>
    <input type="text" id="invUserId" placeholder="ID del usuario a proteger">
    <button type="button" onclick="toggleInvincible()">Activar/Desactivar</button>
    <button onclick="backToMenu()" style="background:#6c757d;">⬅ Volver al menú</button>
  </div>

</div>

<script>
function showForm(form) {
  document.getElementById('menu').style.display = 'none';
  document.getElementById('embedFormContainer').style.display = 'none';
  document.getElementById('tokensFormContainer').style.display = 'none';
  document.getElementById('statusFormContainer').style.display = 'none';
  document.getElementById('invincibleFormContainer').style.display = 'none';

  if(form === 'embed') document.getElementById('embedFormContainer').style.display = 'block';
  if(form === 'tokens') document.getElementById('tokensFormContainer').style.display = 'block';
  if(form === 'status') document.getElementById('statusFormContainer').style.display = 'block';
  if(form === 'invincible') document.getElementById('invincibleFormContainer').style.display = 'block';
}

function backToMenu() {
  document.getElementById('menu').style.display = 'block';
  document.getElementById('embedFormContainer').style.display = 'none';
  document.getElementById('tokensFormContainer').style.display = 'none';
  document.getElementById('statusFormContainer').style.display = 'none';
  document.getElementById('invincibleFormContainer').style.display = 'none';
}

function addField() {
  const container = document.getElementById('fieldsContainer');
  const div = document.createElement('div');
  div.className = 'field';
  div.innerHTML = `<input type="text" placeholder="Nombre campo" class="fieldName">
                   <input type="text" placeholder="Valor campo" class="fieldValue">`;
  container.appendChild(div);
}

// EVENTOS DE FORMULARIOS

// Embed
document.getElementById('embedForm').addEventListener('submit', async e => {
  e.preventDefault();
  const embedData = {
    channelId: document.getElementById('embedChannel').value,
    title: document.getElementById('embedTitle').value,
    description: document.getElementById('embedDescription').value,
    color: document.getElementById('embedColor').value,
    image: document.getElementById('embedImage').value,
    thumbnail: document.getElementById('embedThumbnail').value,
    author: document.getElementById('embedAuthor').value,
    footer: document.getElementById('embedFooter').value,
    fields: []
  };
  document.querySelectorAll('.field').forEach(div => {
    const name = div.querySelector('.fieldName').value;
    const value = div.querySelector('.fieldValue').value;
    if(name && value) embedData.fields.push({name, value});
  });

  const res = await fetch('/send-embed', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(embedData)
  });
  if(res.ok) alert('Embed enviado!');
  else alert('Error al enviar embed');
});

// Tokens
document.getElementById('tokensForm').addEventListener('submit', async e => {
  e.preventDefault();
  const data = {
    cantidad: parseFloat(document.getElementById('cantidadTokens').value),
    canalId: document.getElementById('canalTokens').value,
    mensaje: document.getElementById('mensajeTokens').value
  };
  const res = await fetch('/send-tokens', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(data)
  });
  if(res.ok) alert('Mensaje de tokens enviado!');
  else alert('Error al enviar mensaje');
});

// Estado del bot
document.getElementById('statusForm').addEventListener('submit', async e => {
  e.preventDefault();
  const data = {
    type: document.getElementById('activityType').value,
    name: document.getElementById('activityName').value,
    status: document.getElementById('botStatus').value
  };

  const res = await fetch('/set-bot-status', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(data)
  });

  if(res.ok) alert('Estado del bot actualizado!');
  else alert('Error al actualizar el estado');
});

// Invencibilidad
async function toggleInvincible() {
  const userId = document.getElementById('invUserId').value;
  if (!userId) return alert('Ingresa un ID de usuario');

  const res = await fetch('/toggle-invincible', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ userId })
  });

  const data = await res.json();
  alert(data.message);
}
</script>

</body>
</html>
